<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Emma Rand">
<title>Data Analysis in R - Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-50FV9HPTRE"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-50FV9HPTRE', { 'anonymize_ip': true});
</script><script async="" src="https://hypothes.is/embed.js"></script><script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script><script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script><link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Data Analysis in R</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Welcome!</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../r4babs1/r4babs1.html"> 
<span class="menu-text">BABS 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../r4babs2/r4babs2.html"> 
<span class="menu-text">BABS 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../r4babs4/r4babs4.html" aria-current="page"> 
<span class="menu-text">BABS 4</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../pgt52m/pgt52m.html"> 
<span class="menu-text">PGT 52M</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <a href="https://mastodon.social/users/3mma" title="Emma on mastodon" class="quarto-navigation-tool px-1" aria-label="Emma on mastodon"><i class="bi bi-mastodon"></i></a>
    <a href="https://github.com/3mmaRand/R4BABS" title="Emma on GitHub" class="quarto-navigation-tool px-1" aria-label="Emma on GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../r4babs4/week-2/overview.html">Week 2: DA 2 Immunobiology</a></li><li class="breadcrumb-item"><a href="../../r4babs4/week-2/workshop.html">Workshop</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/r4babs4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Analysis in R for BABS 4</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Week 1: DA 1 Core</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-1/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-1/study_before_workshop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prepare!</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-1/workshop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Workshop</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-1/study_after_workshop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Consolidate!</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Week 2: DA 2 Immunobiology</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-2/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-2/study_before_workshop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prepare!</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-2/workshop.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Workshop</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-2/study_after_workshop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Consolidate!</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Week 4: DA 3 Immunobiology</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-4/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-4/study_before_workshop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prepare!</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-4/workshop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Workshop</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-4/study_after_workshop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Consolidate!</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Week 6: DA 4 Immunobiology</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-6/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-6/study_before_workshop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prepare!</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-6/workshop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Workshop</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r4babs4/week-6/study_after_workshop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Consolidate!</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
<li><a href="#session-overview" id="toc-session-overview" class="nav-link" data-scroll-target="#session-overview">Session overview</a></li>
  </ul>
</li>
  <li>
<a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul class="collapse">
<li><a href="#set-up-a-project" id="toc-set-up-a-project" class="nav-link" data-scroll-target="#set-up-a-project">Set up a Project</a></li>
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link" data-scroll-target="#load-packages">Load packages</a></li>
  <li><a href="#import-the-data" id="toc-import-the-data" class="nav-link" data-scroll-target="#import-the-data">Import the data</a></li>
  <li><a href="#explore-the-data-structure" id="toc-explore-the-data-structure" class="nav-link" data-scroll-target="#explore-the-data-structure">Explore the data structure</a></li>
  <li><a href="#improve-the-column-names" id="toc-improve-the-column-names" class="nav-link" data-scroll-target="#improve-the-column-names">Improve the column names</a></li>
  <li><a href="#drop-the-unused-channels-columns" id="toc-drop-the-unused-channels-columns" class="nav-link" data-scroll-target="#drop-the-unused-channels-columns">Drop the unused channels (columns)</a></li>
  <li><a href="#quality-control-1-automated-instrument-issues" id="toc-quality-control-1-automated-instrument-issues" class="nav-link" data-scroll-target="#quality-control-1-automated-instrument-issues">Quality control 1: Automated instrument issues</a></li>
  <li><a href="#plot-distributions" id="toc-plot-distributions" class="nav-link" data-scroll-target="#plot-distributions">Plot distributions</a></li>
  <li><a href="#transform-the-data" id="toc-transform-the-data" class="nav-link" data-scroll-target="#transform-the-data">Transform the data</a></li>
  <li><a href="#make-data-easier-to-work-with" id="toc-make-data-easier-to-work-with" class="nav-link" data-scroll-target="#make-data-easier-to-work-with">Make data easier to work with</a></li>
  <li><a href="#save-the-data" id="toc-save-the-data" class="nav-link" data-scroll-target="#save-the-data">Save the data</a></li>
  <li>
<a href="#quality-control-2-gating-to-removing-debris" id="toc-quality-control-2-gating-to-removing-debris" class="nav-link" data-scroll-target="#quality-control-2-gating-to-removing-debris">Quality control 2: ‘Gating’ to Removing debris</a>
  <ul class="collapse">
<li><a href="#manual-rectangular-gate" id="toc-manual-rectangular-gate" class="nav-link" data-scroll-target="#manual-rectangular-gate">Manual rectangular gate</a></li>
  </ul>
</li>
  <li><a href="#quality-control-3-gating-to-determine-a-real-signal" id="toc-quality-control-3-gating-to-determine-a-real-signal" class="nav-link" data-scroll-target="#quality-control-3-gating-to-determine-a-real-signal">Quality control 3: Gating to determine a ‘real’ signal?</a></li>
  <li><a href="#look-after-future-you" id="toc-look-after-future-you" class="nav-link" data-scroll-target="#look-after-future-you">Look after future you!</a></li>
  </ul>
</li>
  <li><a href="#well-done" id="toc-well-done" class="nav-link" data-scroll-target="#well-done">🥳 Well Done! 🎉</a></li>
  <li><a href="#independent-study-following-the-workshop" id="toc-independent-study-following-the-workshop" class="nav-link" data-scroll-target="#independent-study-following-the-workshop">Independent study following the workshop</a></li>
  <li><a href="#the-code-file" id="toc-the-code-file" class="nav-link" data-scroll-target="#the-code-file">The Code file</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../r4babs4/week-2/overview.html">Week 2: DA 2 Immunobiology</a></li><li class="breadcrumb-item"><a href="../../r4babs4/week-2/workshop.html">Workshop</a></li></ol></nav><div class="quarto-title">
<h1 class="title">Workshop</h1>
<p class="subtitle lead">Data Analysis 2: Immunobiology - Sample data analysis</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="introduction" class="level1"><h1>Introduction</h1>
<section id="session-overview" class="level2"><h2 class="anchored" data-anchor-id="session-overview">Session overview</h2>
<p>In this workshop you will learn how to analyse some sample flow cytometry data.</p>
</section></section><section id="exercises" class="level1"><h1>Exercises</h1>
<section id="set-up-a-project" class="level2"><h2 class="anchored" data-anchor-id="set-up-a-project">Set up a Project</h2>
<p>🎬 Start RStudio from the Start menu</p>
<p>🎬 Make an RStudio project. Be deliberate about where you create it so that it is a good place for you</p>
<p>🎬 Use the Files pane to make a folders for the data. I suggest <code>data-raw/</code> and <code>data-meta/</code></p>
<p>🎬 Make a new script called <code>sample-data-analysis.R</code> to carry out the rest of the work.</p>
<p>🎬 Record what you do and what you find out. All of it! Make notes on the inputs and outputs of each command. This will help you work out problems analysing your own data.</p>
</section><section id="load-packages" class="level2"><h2 class="anchored" data-anchor-id="load-packages">Load packages</h2>
<p>We need three packages for this workshop:</p>
<ul>
<li><p><strong><code>tidyverse</code></strong> <span class="citation" data-cites="tidyverse">(<a href="#ref-tidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span>: importing the meta data which is in a text file, working with the data once it is in a dataframe to filter, summarise and plot.</p></li>
<li><p><strong><code>flowCore</code></strong> <span class="citation" data-cites="flowCore">(<a href="#ref-flowCore" role="doc-biblioref">Ellis et al. 2024</a>)</span>: to import data from flow cytometry files (<code>.fcs</code>), apply the logicle transformation, and use functions for using a “flowSet” data structure.</p></li>
<li><p><strong><code>flowAI</code></strong> <span class="citation" data-cites="flowAI">(<a href="#ref-flowAI" role="doc-biblioref">Monaco et al. 2016</a>)</span>: which performs automated quality control by checking for changes in instrument speed and signal intensity that indicate a problem for the reading for that cells</p></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Working on University computers
</div>
</div>
<div class="callout-body-container callout-body">
<p>These packages are installed already. You can go straight to loading them.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Working on your own machine
</div>
</div>
<div class="callout-body-container callout-body">
<p>You will need to install these packages.</p>
<p>You can install <strong><code>tidyverse</code></strong> from CRAN in the normal way.</p>
<p><strong><code>flowCore</code></strong> and <strong><code>flowAI</code></strong> are not on CRAN but come from <a href="https://www.bioconductor.org/">Bioconductor</a>.</p>
<ul>
<li><p>first install <strong><code>BiocManager</code></strong> from CRAN in the normal way.</p></li>
<li><p>then install from Bioconductor using <code>BiocManager::install("flowCore")</code> and <code>BiocManager::install("flowAI")</code></p></li>
</ul>
<p>If you have difficulty installing these packages, use the <a href="https://www.york.ac.uk/it-services/services/vds/">Virtual Desktop Service</a> which allows you to log into a university machine from your laptop.</p>
</div>
</div>
<p>🎬 Load <strong><code>tidyverse</code></strong>,<strong><code>flowCore</code></strong> and <strong><code>flowAI</code></strong></p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">flowCore</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">flowAI</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: Load tidyverse last because <strong><code>flowCore</code></strong> also has some functions with the same names as functions in <strong><code>tidyverse</code></strong> and you will want the tidyverse ones.</p>
</section><section id="import-the-data" class="level2"><h2 class="anchored" data-anchor-id="import-the-data">Import the data</h2>
<p>There are six data files, one for each treatment and antibody combination:</p>
<ul>
<li><a href="data-raw/ECOLIGreen_ISOTYPE.fcs">ECOLIGreen_ISOTYPE.fcs</a></li>
<li><a href="data-raw/ECOLIGreen_TNFAPC.fcs">ECOLIGreen_TNFAPC.fcs</a></li>
<li><a href="data-raw/LPS_ISOTYPE.fcs">LPS_ISOTYPE.fcs</a></li>
<li><a href="data-raw/LPS_TNFAPC.fcs">LPS_TNFAPC.fcs</a></li>
<li><a href="data-raw/MEDIA_ISOTYPE.fcs">MEDIA_ISOTYPE.fcs</a></li>
<li><a href="data-raw/MEDIA_TNFAPC.fcs">MEDIA_TNFAPC.fcs</a></li>
</ul>
<p>🎬 Save copies of each file (right click and save as) to your <code>data-raw/</code> folder.</p>
<p>These are six files associated with one experiment.</p>
<p>We are going to use the command <code><a href="https://rdrr.io/pkg/flowCore/man/read.flowSet.html">read.flowSet()</a></code> from the <strong><code>flowCore</code></strong> package to import the data. In R, the data from one file is stored in a “flowFrame” object. A flowFrame is a data structure in the same way that a dataframe or a vector is a data structure. A flowFrame has “slots”. The first slot is called <code>exprs</code> and contains the data itself in matrix which looks just like a dataframe. The second is called <code>parameters</code> and contains the names of the columns in <code>exprs</code>. The third is called <code>description</code> and contains information about the <code>.fcs</code> file.</p>
<p>A “flowSet” is a list of flowFrames which are related. They are related in that they have the same column names, came off the same machine, and are part of the same experiment. Such data needs to be treated int he same way which is why it is useful to have a structure like a flowSet.</p>
<p>🎬 Make a variable to hold the file names:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">myfiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">"data-raw"</span>, pattern <span class="op">=</span> <span class="st">".fcs$"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://rdrr.io/r/base/list.files.html">list.files()</a></code> will return a character vector of the names of the files <code>data-raw/</code>. The <code>pattern</code> argument is a “regular expression” which is used to filter the names of the files. Here we are asking for the names of the files which end in <code>.fcs</code>. This would be very useful if you had other file types in that folder. In our case, there are only <code>.fcs</code> files in that folder.</p>
<p>Type <code>myfiles</code> to check it contains what you expect.</p>
<p>🎬 Use <code><a href="https://rdrr.io/pkg/flowCore/man/read.flowSet.html">read.flowSet()</a></code> to import the files from the folder <code>data-raw/</code> that are listed in the variable <code>myfiles</code> and name the resulting flowSet <code>fs</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/read.flowSet.html">read.flowSet</a></span><span class="op">(</span><span class="va">myfiles</span>, </span>
<span>                   path <span class="op">=</span> <span class="st">"data-raw"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="explore-the-data-structure" class="level2"><h2 class="anchored" data-anchor-id="explore-the-data-structure">Explore the data structure</h2>
<p>🎬 Type <code>fs</code> to see what it contains:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fs</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A flowSet with 6 experiments.

column names(22): TIME Time MSW ... FL 8 Log Event Count</code></pre>
</div>
</div>
<p>We can use a list index to access the first flowFrame in the flowSet.</p>
<p>🎬 Type <code>fs[[1]]</code> to see the information about the first flowFrame in the flowSet:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>flowFrame object 'ECOLIGreen_ISOTYPE.fcs'
with 50000 cells and 22 observables:
            name         desc     range  minRange  maxRange
$P1         TIME     Time LSW     65536         0     65535
$P2     Time MSW     Time MSW     65536         0     65535
$P3  Pulse Width  Pulse Width       512         0       511
$P4       FS Lin           FS     65536         0     65535
$P5      FS Area           FS     65536         0     65535
...          ...          ...       ...       ...       ...
$P18    FL 3 Log PE-Texas Red     65536         1     10000
$P19    FL 8 Lin          APC     65536         0     65535
$P20   FL 8 Area          APC     65536         0     65535
$P21    FL 8 Log          APC     65536         1     10000
$P22 Event Count  Event Count     65536         0     65535
278 keywords are stored in the 'description' slot</code></pre>
</div>
</div>
<p>🎬 You can use the <code><a href="https://rdrr.io/pkg/Biobase/man/exprs.html">exprs()</a></code> function to access the actual data and pipe it to <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code> to show it in a window:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html">exprs</a></span><span class="op">(</span><span class="va">fs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>🎬 List the column names in each of the flowFrames:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "TIME"        "Time MSW"    "Pulse Width" "FS Lin"      "FS Area"    
 [6] "FS Log"      "SS Lin"      "SS Area"     "SS Log"      "FL 1 Lin"   
[11] "FL 1 Area"   "FL 1 Log"    "FL 2 Lin"    "FL 2 Area"   "FL 2 Log"   
[16] "FL 3 Lin"    "FL 3 Area"   "FL 3 Log"    "FL 8 Lin"    "FL 8 Area"  
[21] "FL 8 Log"    "Event Count"</code></pre>
</div>
</div>
</section><section id="improve-the-column-names" class="level2"><h2 class="anchored" data-anchor-id="improve-the-column-names">Improve the column names</h2>
<p>Names like <code>FL 1</code> meaning “fluorescence channel 1” are not very informative. In our experiment we also only used channel 1 and channel 8. A list of more useful column names are given in <a href="data-meta/meta.csv">meta.csv</a>. We can import this file and use the resulting dataframe to rename columns in our flowFrames.</p>
<p>🎬 Save a copy of the file (right click and save as) to your <code>data-meta/</code> folder</p>
<p>🎬 Import the meta data and examine it:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data-meta/meta.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; ">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead><tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">name</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">desc</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">range</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">minRange</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">maxRange</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">TIME</td>
<td style="text-align: left;">Time LSW</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="even">
<td style="text-align: left;">Time_MSW</td>
<td style="text-align: left;">Time MSW</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pulse_Width</td>
<td style="text-align: left;">Pulse Width</td>
<td style="text-align: right;">512</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">511</td>
</tr>
<tr class="even">
<td style="text-align: left;">FS_Lin</td>
<td style="text-align: left;">FS</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FS_Area</td>
<td style="text-align: left;">FS</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="even">
<td style="text-align: left;">FS_Log</td>
<td style="text-align: left;">FS</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SS_Lin</td>
<td style="text-align: left;">SS</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="even">
<td style="text-align: left;">SS_Area</td>
<td style="text-align: left;">SS</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SS_Log</td>
<td style="text-align: left;">SS</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: left;">E_coli_FITC_Lin</td>
<td style="text-align: left;">E_coli_FITC</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E_coli_FITC_Area</td>
<td style="text-align: left;">E_coli_FITC</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="even">
<td style="text-align: left;">E_coli_FITC_Log</td>
<td style="text-align: left;">E_coli_FITC</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">delete_1_Lin</td>
<td style="text-align: left;">delete_1</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="even">
<td style="text-align: left;">delete_1_Area</td>
<td style="text-align: left;">delete_1</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="odd">
<td style="text-align: left;">delete_1_Log</td>
<td style="text-align: left;">delete_1</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: left;">delete_2_Lin</td>
<td style="text-align: left;">delete_2</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="odd">
<td style="text-align: left;">delete_2_Area</td>
<td style="text-align: left;">delete_2</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="even">
<td style="text-align: left;">delete_2_Log</td>
<td style="text-align: left;">delete_2</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TNFa_APC_Lin</td>
<td style="text-align: left;">TNFa_APC</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="even">
<td style="text-align: left;">TNFa_APC_Area</td>
<td style="text-align: left;">TNFa_APC</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TNFa_APC_Log</td>
<td style="text-align: left;">TNFa_APC</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Event_Count</td>
<td style="text-align: left;">Event_Count</td>
<td style="text-align: right;">65536</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</div>
<p>The first column gives the name of the column we would like to use. The columns labelled with “delete” were not used and we will be able to drop them.</p>
<p>🎬 Assign the names in <code>meta$name</code> to the columns in the flowFrames:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">meta</span><span class="op">$</span><span class="va">name</span></span>
<span><span class="co"># view the effect</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "TIME"             "Time_MSW"         "Pulse_Width"      "FS_Lin"          
 [5] "FS_Area"          "FS_Log"           "SS_Lin"           "SS_Area"         
 [9] "SS_Log"           "E_coli_FITC_Lin"  "E_coli_FITC_Area" "E_coli_FITC_Log" 
[13] "delete_1_Lin"     "delete_1_Area"    "delete_1_Log"     "delete_2_Lin"    
[17] "delete_2_Area"    "delete_2_Log"     "TNFa_APC_Lin"     "TNFa_APC_Area"   
[21] "TNFa_APC_Log"     "Event_Count"     </code></pre>
</div>
</div>
</section><section id="drop-the-unused-channels-columns" class="level2"><h2 class="anchored" data-anchor-id="drop-the-unused-channels-columns">Drop the unused channels (columns)</h2>
<p>🎬 subset the flowSet to include only the columns we are interested in:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fs</span> <span class="op">&lt;-</span> <span class="va">fs</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">19</span><span class="op">:</span><span class="fl">22</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This means columns 13 to 18 are dropped. Note that those columns are dropped in every flowFrame in the flowSet. That’s the power of the flowSet data structure.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "TIME"             "Time_MSW"         "Pulse_Width"      "FS_Lin"          
 [5] "FS_Area"          "FS_Log"           "SS_Lin"           "SS_Area"         
 [9] "SS_Log"           "E_coli_FITC_Lin"  "E_coli_FITC_Area" "E_coli_FITC_Log" 
[13] "TNFa_APC_Lin"     "TNFa_APC_Area"    "TNFa_APC_Log"     "Event_Count"     </code></pre>
</div>
</div>
</section><section id="quality-control-1-automated-instrument-issues" class="level2"><h2 class="anchored" data-anchor-id="quality-control-1-automated-instrument-issues">Quality control 1: Automated instrument issues</h2>
<p><strong><code>flowAI</code></strong> is a package that provides a set of tools for automated QC of flow cytometry data. It checks for:</p>
<ul>
<li>changes in instrument speed,</li>
<li>changes signal intensity</li>
<li>cells that are outside the dynamic range</li>
</ul>
<p>It generates a new flowSet with the problematic events removed along with a folder containing filtered <code>.fcs</code> files and a quality control report in html format. It will take a few minutes to do all files.</p>
<p>🎬 Run the automated quality control:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Quality control for the file: ECOLIGreen_ISOTYPE
43.33% of anomalous cells detected in the flow rate check. 
0% of anomalous cells detected in signal acquisition check. 
0% of anomalous cells detected in the dynamic range check. 
Quality control for the file: ECOLIGreen_TNFAPC
44.96% of anomalous cells detected in the flow rate check. 
0% of anomalous cells detected in signal acquisition check. 
0% of anomalous cells detected in the dynamic range check. 
Quality control for the file: LPS_ISOTYPE
6.39% of anomalous cells detected in the flow rate check. 
0% of anomalous cells detected in signal acquisition check. 
0% of anomalous cells detected in the dynamic range check. 
Quality control for the file: LPS_TNFAPC
46.56% of anomalous cells detected in the flow rate check. 
0% of anomalous cells detected in signal acquisition check. 
0% of anomalous cells detected in the dynamic range check. 
Quality control for the file: MEDIA_ISOTYPE
45.73% of anomalous cells detected in the flow rate check. 
0% of anomalous cells detected in signal acquisition check. 
0% of anomalous cells detected in the dynamic range check. 
Quality control for the file: MEDIA_TNFAPC
45.85% of anomalous cells detected in the flow rate check. 
0% of anomalous cells detected in signal acquisition check. 
0% of anomalous cells detected in the dynamic range check. </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fs_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowAI/man/flow_auto_qc.html">flow_auto_qc</a></span><span class="op">(</span><span class="va">fs</span>, </span>
<span>                         folder_results <span class="op">=</span> <span class="st">"sample-QC"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>❓ What has been removed through the QC process?</p>
<p>❓ What is in the folder “sample-QC”?</p>
<p>This is an example report: <a href="sample-QC/ECOLIGreen_TNFAPC_QC.html">ECOLIGreen_TNFAPC flowAI report</a></p>
</section><section id="plot-distributions" class="level2"><h2 class="anchored" data-anchor-id="plot-distributions">Plot distributions</h2>
<p>Plotting the distributions of our variables is very useful for getting an overview of our data. We’ll just look at the first flowFrame to get over the principles.</p>
<p>🎬 Plot the distribution of the TNFa_APC signal in the first flowFrame in the flowSet:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html">exprs</a></span><span class="op">(</span><span class="va">fs_clean</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">TNFa_APC_Lin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="workshop_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is a very skewed distribution which makes visualisation hard. It is common to log skewed distributions to improve visualisation. We have a column called <code>TNFa_APC_Log</code> so let’s look at that.</p>
<p>🎬 Plot the distribution of <code>TNFa_APC_Log</code> :</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html">exprs</a></span><span class="op">(</span><span class="va">fs_clean</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">TNFa_APC_Log</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="workshop_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Hmmmm, The column labelled Log, does not seem to be.</p>
<p>🎬 Plot the distribution of the logged <code>TNFa_APC_Lin</code> column:</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html">exprs</a></span><span class="op">(</span><span class="va">fs_clean</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">TNFa_APC_Lin</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="workshop_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now our data are easier to see.</p>
</section><section id="transform-the-data" class="level2"><h2 class="anchored" data-anchor-id="transform-the-data">Transform the data</h2>
<p>In fact, we will apply a different transformation called “logicle” <span class="citation" data-cites="parks2006">(<a href="#ref-parks2006" role="doc-biblioref">Parks, Roederer, and Moore 2006</a>)</span>. This transformation is has a similar effect as logging but avoids some problems that can occur with flow cytometry data and especially flow cytometry data that have been “compensated” . Compensation is routinely applied to flow cytometry data to correct for fluorophores being detected in in multiple channels. This was not a problem in our experiment.</p>
<p>A transformation is applied in two steps: the transformations needed is estimated from the data and then that transformation is applied.</p>
<p>We need to apply the transformation only to apply it to the <code>TNFa_APC_Lin</code> and <code>E_coli_FITC_Lin</code> columns. These in the 10th and 13th columns of the flowFrames.</p>
<p>🎬 Estimate the transformation from the data:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/logicleTransform.html">estimateLogicle</a></span><span class="op">(</span><span class="va">fs_clean</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                         <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fs_clean</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">13</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>🎬 Apply the transformation to all the<code>TNFa_APC_Lin</code> and <code>E_coli_FITC_Lin</code> columns the flowSet:</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># apply the transformation</span></span>
<span><span class="va">fs_clean_trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/transform.html">transform</a></span><span class="op">(</span><span class="va">fs_clean</span>, <span class="va">trans</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>🎬 Examine the effect:</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html">exprs</a></span><span class="op">(</span><span class="va">fs_clean_trans</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">TNFa_APC_Lin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="workshop_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>That looks better.</p>
</section><section id="make-data-easier-to-work-with" class="level2"><h2 class="anchored" data-anchor-id="make-data-easier-to-work-with">Make data easier to work with</h2>
<p>We are going to get the data from the flowSet and put in a dataframe. FlowCore contains many functions for gating (filtering), plotting and summarising flowSets but putting the data into a dataframe will make it easier for you to use tools you already know and understand what you are doing.</p>
<p>We will be using familiar tools like <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>, <code><a href="https://rdrr.io/pkg/flowCore/man/filter-methods.html">filter()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code></p>
<p>🎬 Put the transformed data into a data frame:</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Put into a data frame for ease of use</span></span>
<span><span class="va">clean_trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/fsApply.html">fsApply</a></span><span class="op">(</span><span class="va">fs_clean_trans</span>, <span class="va">exprs</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>fsApply(flowSet, function)</code> applies a function to every flowFrame in a flowSet. Here we are accessed the data matirx in each with <code><a href="https://rdrr.io/pkg/Biobase/man/exprs.html">exprs()</a></code>.</p>
<p>The are 171245 rows (cells) in the dataset. You can view it by clicking on the dataframe in the Environment. At the moment, we cannot tell which row (cell) is from which sample. We can add the sample names as a column in that dataframe.</p>
<ul>
<li><p>Each sample name needs to appear as many times as there are cells (events) in the corresponding flowFrame. For example, <code>dim(fs_clean_trans[[1]])["events"]</code> is 28335 cells.</p></li>
<li><p><code>sampleNames(fs_clean_trans)</code> gives the names of the samples.</p></li>
<li><p>We can use the <code><a href="https://rdrr.io/r/base/rep.html">rep()</a></code> function to repeat the sample names the correct number of times.</p></li>
</ul>
<p>🎬 Add the sample name to each row:</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">clean_trans</span> <span class="op">&lt;-</span> <span class="va">clean_trans</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu">sampleNames</span><span class="op">(</span><span class="va">fs_clean_trans</span><span class="op">)</span>,</span>
<span>                             times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">fs_clean_trans</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="st">"events"</span><span class="op">]</span>,</span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">fs_clean_trans</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="st">"events"</span><span class="op">]</span>,</span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">fs_clean_trans</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="st">"events"</span><span class="op">]</span>,</span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">fs_clean_trans</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="st">"events"</span><span class="op">]</span>,</span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">fs_clean_trans</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="st">"events"</span><span class="op">]</span>,</span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">fs_clean_trans</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="st">"events"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The sample name contains the information about which antibody and treatment the sample was. Our analysis will be a little easier if we add this information to separate columns. We can extract the antibody and treatment from the sample name using the <code><a href="https://tidyr.tidyverse.org/reference/extract.html">extract()</a></code> function and two “regular expressions”.</p>
<p>🎬 Add columns for treatment and antibody by extracting that information from the sample name:</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">clean_trans</span> <span class="op">&lt;-</span> <span class="va">clean_trans</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/extract.html">extract</a></span><span class="op">(</span><span class="va">sample</span>, </span>
<span>          remove <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"treatment"</span>, <span class="st">"antibody"</span><span class="op">)</span>,</span>
<span>          <span class="st">"([a-zA-Z]+)_([a-zA-Z]+).fcs"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>the sample name is treatment_antibody</li>
<li>each pattern matching the treatment and antibody is enclosed in parentheses</li>
<li>we want to keep those patterns to go in the new columns</li>
<li>the underscore is matched but not enclosed in parentheses so it is not kept</li>
<li>
<code>.fcs</code> is matched but not enclosed in parentheses so it is not kept</li>
<li>the <code>remove = FALSE</code> argument means that the original column is kept</li>
<li>
<code>[]</code> enclose a set of characters</li>
<li>
<code>a-z</code> means any lower case letter, <code>A-Z</code> means any upper case letter so <code>[a-zA-Z]</code> means any letter</li>
<li>
<code>+</code> means one or more of the preceding character set</li>
<li>so<code>[a-zA-Z]+</code> means one or more letters</li>
</ul>
<p>🎬 View the dataframe to see the new columns.</p>
<p>Our treatments have an order. Media is the control, LPS should be next and ECOLIGreen should be last. We can use the <code><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel()</a></code> function to put groups in order so that our graphs are better to interpret.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">clean_trans</span> <span class="op">&lt;-</span> <span class="va">clean_trans</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"MEDIA"</span>,</span>
<span>                                              <span class="st">"LPS"</span>,</span>
<span>                                              <span class="st">"ECOLIGreen"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="save-the-data" class="level2"><h2 class="anchored" data-anchor-id="save-the-data">Save the data</h2>
<p>We have cleaned and transform our data. It is a good idea to save it at this point so that we can start from here if we need to.</p>
<p>🎬 Save the data:</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">clean_trans</span>, <span class="st">"data-processed/ai_clean_logicle_trans.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="quality-control-2-gating-to-removing-debris" class="level2"><h2 class="anchored" data-anchor-id="quality-control-2-gating-to-removing-debris">Quality control 2: ‘Gating’ to Removing debris</h2>
<p>Some of the cells will have died and broken during the experiment. We need to perform quality control on our data to remove observations that have that have the size and granularity that is not typical of a live cell. This is done by filtering on the forward scatter (size) and side scatter (granularity) channels.</p>
<p>In flow cytometry, it is common to describe filtering as “gating” and the observations (cells) being kept as “in the gate”.</p>
<p>We create a scatter plot of the forward scatter (size) and side scatter (granularity) for each sample to see where we should put the gate.</p>
<p>We could use <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> but many points will overlap so it is difficult to see the density of points. <code><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex()</a></code> puts the points in bins and colours the bin with the number of points.</p>
<p>🎬 Plot the forward scatter and side scatter for each sample</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">clean_trans</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">FS_Lin</span>, y <span class="op">=</span> <span class="va">SS_Lin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">128</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">antibody</span> <span class="op">~</span> <span class="va">treatment</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="workshop_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see a cloud of points in the middle of the plot. This is where the cells are. There are also a lot of points in the bottom left corner. These are likely to be debris. We can draw a gate around the cloud of points to remove the debris. We should use the same filter/gate on all six data sets for consistency. The gates can be a rectangle, polygon, or ellipse. We will use a rectangle first.</p>
<section id="manual-rectangular-gate" class="level3"><h3 class="anchored" data-anchor-id="manual-rectangular-gate">Manual rectangular gate</h3>
<p>Use the zoom on the plot window to better see the cloud of points and the axis values. You need to use minimum and maximum <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> values to define the rectangle. I chose the the values below but you might judge the gate differently.</p>
<p>🎬 Define the minimum and maximum <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> values for the gate:</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">xmin</span> <span class="op">&lt;-</span> <span class="fl">15000</span></span>
<span><span class="va">xmax</span> <span class="op">&lt;-</span> <span class="fl">35000</span></span>
<span><span class="va">ymin</span> <span class="op">&lt;-</span> <span class="fl">7500</span></span>
<span><span class="va">ymax</span> <span class="op">&lt;-</span> <span class="fl">28000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>🎬 Put those values in a dataframe so we can plot the gate on the hexbin plot:</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">box</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">xmin</span>, <span class="va">xmin</span>, <span class="va">xmax</span>, <span class="va">xmax</span><span class="op">)</span>,</span>
<span>                  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ymin</span>, <span class="va">ymax</span>, <span class="va">ymax</span>, <span class="va">ymin</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>🎬 Plot the forward scatter and side scatter for each sample with the gate:</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">clean_trans</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">FS_Lin</span>, y <span class="op">=</span> <span class="va">SS_Lin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">128</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">box</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, </span>
<span>               fill <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>               linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">antibody</span> <span class="op">~</span> <span class="va">treatment</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="workshop_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>🎬 Adjust the values of <code>xmin</code>, <code>xmax</code>, <code>ymin</code>, and <code>ymax</code> to get a gate that you are happy with.</p>
<p>We have drawn the gate on the plot but we need to use it to filter out the debris (rows) from our data. We want only the cells with <code>FS_Lin</code> values that are between the <code>xmin</code> and <code>xmax</code> and <code>SS_Lin</code> that are between <code>ymin</code> and <code>ymax</code> values we chose.</p>
<p>🎬 Filter the data to remove the debris:</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># filter out the debris</span></span>
<span><span class="va">clean_trans_nondebris</span> <span class="op">&lt;-</span> <span class="va">clean_trans</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/filter-methods.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span><span class="op">(</span><span class="va">FS_Lin</span>, <span class="va">xmin</span>, <span class="va">xmax</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span><span class="op">(</span><span class="va">SS_Lin</span>, <span class="va">ymin</span>, <span class="va">ymax</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>clean_trans_nondebris</code> now has 161010 cells. We should report how many cells were in the gate for each sample.</p>
<p>🎬 Find the number of cells in each sample after flowAI cleaning:</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># </span></span>
<span><span class="va">clean_trans_n</span> <span class="op">&lt;-</span>  <span class="va">clean_trans</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">antibody</span>, <span class="va">treatment</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">antibody</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ISOTYPE</td>
<td style="text-align: left;">MEDIA</td>
<td style="text-align: right;">14788</td>
</tr>
<tr class="even">
<td style="text-align: left;">ISOTYPE</td>
<td style="text-align: left;">LPS</td>
<td style="text-align: right;">46806</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ISOTYPE</td>
<td style="text-align: left;">ECOLIGreen</td>
<td style="text-align: right;">28335</td>
</tr>
<tr class="even">
<td style="text-align: left;">TNFAPC</td>
<td style="text-align: left;">MEDIA</td>
<td style="text-align: right;">27076</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TNFAPC</td>
<td style="text-align: left;">LPS</td>
<td style="text-align: right;">26722</td>
</tr>
<tr class="even">
<td style="text-align: left;">TNFAPC</td>
<td style="text-align: left;">ECOLIGreen</td>
<td style="text-align: right;">27518</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>🎬 Find the number of cells in each sample after flowAI cleaning <em>and</em> removing debris</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># number of cells in each sample</span></span>
<span><span class="va">clean_trans_nondebris_n</span> <span class="op">&lt;-</span>  <span class="va">clean_trans_nondebris</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">antibody</span>, <span class="va">treatment</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_nondebris <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">antibody</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n_nondebris</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ISOTYPE</td>
<td style="text-align: left;">MEDIA</td>
<td style="text-align: right;">13106</td>
</tr>
<tr class="even">
<td style="text-align: left;">ISOTYPE</td>
<td style="text-align: left;">LPS</td>
<td style="text-align: right;">45138</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ISOTYPE</td>
<td style="text-align: left;">ECOLIGreen</td>
<td style="text-align: right;">26866</td>
</tr>
<tr class="even">
<td style="text-align: left;">TNFAPC</td>
<td style="text-align: left;">MEDIA</td>
<td style="text-align: right;">24419</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TNFAPC</td>
<td style="text-align: left;">LPS</td>
<td style="text-align: right;">25479</td>
</tr>
<tr class="even">
<td style="text-align: left;">TNFAPC</td>
<td style="text-align: left;">ECOLIGreen</td>
<td style="text-align: right;">26002</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>🎬 Join two data frames together using the combination of the treatment and the antibody and calculate what % cells were removed from each sample:</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">clean_trans_nondebris_n</span> <span class="op">&lt;-</span> <span class="va">clean_trans_nondebris_n</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">clean_trans_n</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"antibody"</span>, <span class="st">"treatment"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>perc_nondebris <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">n_nondebris</span><span class="op">/</span><span class="va">n</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">antibody</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n_nondebris</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">perc_nondebris</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ISOTYPE</td>
<td style="text-align: left;">MEDIA</td>
<td style="text-align: right;">13106</td>
<td style="text-align: right;">14788</td>
<td style="text-align: right;">88.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">ISOTYPE</td>
<td style="text-align: left;">LPS</td>
<td style="text-align: right;">45138</td>
<td style="text-align: right;">46806</td>
<td style="text-align: right;">96.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ISOTYPE</td>
<td style="text-align: left;">ECOLIGreen</td>
<td style="text-align: right;">26866</td>
<td style="text-align: right;">28335</td>
<td style="text-align: right;">94.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">TNFAPC</td>
<td style="text-align: left;">MEDIA</td>
<td style="text-align: right;">24419</td>
<td style="text-align: right;">27076</td>
<td style="text-align: right;">90.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TNFAPC</td>
<td style="text-align: left;">LPS</td>
<td style="text-align: right;">25479</td>
<td style="text-align: right;">26722</td>
<td style="text-align: right;">95.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">TNFAPC</td>
<td style="text-align: left;">ECOLIGreen</td>
<td style="text-align: right;">26002</td>
<td style="text-align: right;">27518</td>
<td style="text-align: right;">94.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>🎬 Plot the forward scatter and side scatter for each sample with the gate and the number of cells in each sample</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">clean_trans</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">FS_Lin</span>, y <span class="op">=</span> <span class="va">SS_Lin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">128</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">box</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, </span>
<span>               fill <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>               linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">clean_trans_nondebris_n</span>, </span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">perc_nondebris</span>, <span class="st">"%"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            x <span class="op">=</span> <span class="fl">45000</span>, </span>
<span>            y <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>            colour <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">antibody</span> <span class="op">~</span> <span class="va">treatment</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="workshop_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>🎬 Plot the <code>TNFa_APC_Lin</code> and <code>E_coli_FITC_Lin</code> signals for these live cells:</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">clean_trans_nondebris</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">E_coli_FITC_Lin</span>, </span>
<span>                                  y <span class="op">=</span> <span class="va">TNFa_APC_Lin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">128</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">antibody</span> <span class="op">~</span> <span class="va">treatment</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="workshop_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="quality-control-3-gating-to-determine-a-real-signal" class="level2"><h2 class="anchored" data-anchor-id="quality-control-3-gating-to-determine-a-real-signal">Quality control 3: Gating to determine a ‘real’ signal?</h2>
<p>From now on we are working with the clean data, that is the dataframe <code>clean_trans_nondebris</code>.</p>
<p>We have two signals:</p>
<ul>
<li>
<code>TNFa_APC_Lin</code> is should indicate the amount of TNF-α protein in the cell</li>
<li>
<code>E_coli_FITC_Lin</code> should indicate the amount of <em>E. coli</em> in the cell</li>
</ul>
<p>When the antibody is the isotype there is no TNF-α so that level of <code>TNFa_APC_Lin</code> signal is the control. If you look at the top row of scatter plots, you can see that when values of <code>TNFa_APC_Lin</code> are below 2 the cells are negative for TNF-α and for <code>TNFa_APC_Lin</code> values above 2 the cells are positive for TNFa.</p>
<p>We can use this to set a threshold for the <code>TNFa_APC_Lin</code> signal and label the cells as positive or negative for TNF-α.</p>
<p>🎬 Define the threshold for the <code>TNFa_APC_Lin</code> signal:</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">apc_cut</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>🎬 Plot the <code>TNFa_APC_Lin</code> and <code>E_coli_FITC_Lin</code> with the threshold for the <code>TNFa_APC_Lin</code> signal:</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">clean_trans_nondebris</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">E_coli_FITC_Lin</span>, </span>
<span>                                  y <span class="op">=</span> <span class="va">TNFa_APC_Lin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">128</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">apc_cut</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">antibody</span> <span class="op">~</span> <span class="va">treatment</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="workshop_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>🎬 Add a label, <code>tnfa</code>, to the data to indicate if the cell is positive or negative for TNF-α</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">clean_trans_nondebris</span> <span class="op">&lt;-</span> <span class="va">clean_trans_nondebris</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>tnfa <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">TNFa_APC_Lin</span> <span class="op">&lt;</span> <span class="va">apc_cut</span> <span class="op">~</span> <span class="st">"TNF-α -'ve"</span>,</span>
<span>                               <span class="va">TNFa_APC_Lin</span> <span class="op">&gt;=</span> <span class="va">apc_cut</span> <span class="op">~</span> <span class="st">"TNF-α +'ve"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>🎬 Summarise each group by finding the number of TNF-α positive cells and the mean <code>TNFa_APC_Lin</code> signal for each group:</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">clean_trans_nondebris_tfna_pos</span> <span class="op">&lt;-</span> <span class="va">clean_trans_nondebris</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/filter-methods.html">filter</a></span><span class="op">(</span><span class="va">tnfa</span> <span class="op">==</span> <span class="st">"TNF-α +'ve"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">antibody</span>, <span class="va">treatment</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_pos <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            mean_apc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">TNFa_APC_Lin</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">antibody</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n_pos</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_apc</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ISOTYPE</td>
<td style="text-align: left;">MEDIA</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">2.141238</td>
</tr>
<tr class="even">
<td style="text-align: left;">ISOTYPE</td>
<td style="text-align: left;">LPS</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">2.148879</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ISOTYPE</td>
<td style="text-align: left;">ECOLIGreen</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">2.139884</td>
</tr>
<tr class="even">
<td style="text-align: left;">TNFAPC</td>
<td style="text-align: left;">MEDIA</td>
<td style="text-align: right;">13503</td>
<td style="text-align: right;">2.264890</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TNFAPC</td>
<td style="text-align: left;">LPS</td>
<td style="text-align: right;">25414</td>
<td style="text-align: right;">3.138646</td>
</tr>
<tr class="even">
<td style="text-align: left;">TNFAPC</td>
<td style="text-align: left;">ECOLIGreen</td>
<td style="text-align: right;">25965</td>
<td style="text-align: right;">3.265506</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>🎬 We can add the number of non-debris cells to this data frame and calculate the percentage of non-debris cells that are positive for TNF-α:</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">clean_trans_nondebris_tfna_pos</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">clean_trans_nondebris_tfna_pos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">clean_trans_nondebris_n</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"antibody"</span>, <span class="st">"treatment"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>perc_tfna_pos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">n_pos</span><span class="op">/</span><span class="va">n_nondebris</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">antibody</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n_pos</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_apc</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n_nondebris</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">perc_nondebris</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">perc_tfna_pos</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ISOTYPE</td>
<td style="text-align: left;">MEDIA</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">2.141238</td>
<td style="text-align: right;">13106</td>
<td style="text-align: right;">14788</td>
<td style="text-align: right;">88.6</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">ISOTYPE</td>
<td style="text-align: left;">LPS</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">2.148879</td>
<td style="text-align: right;">45138</td>
<td style="text-align: right;">46806</td>
<td style="text-align: right;">96.4</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ISOTYPE</td>
<td style="text-align: left;">ECOLIGreen</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">2.139884</td>
<td style="text-align: right;">26866</td>
<td style="text-align: right;">28335</td>
<td style="text-align: right;">94.8</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">TNFAPC</td>
<td style="text-align: left;">MEDIA</td>
<td style="text-align: right;">13503</td>
<td style="text-align: right;">2.264890</td>
<td style="text-align: right;">24419</td>
<td style="text-align: right;">27076</td>
<td style="text-align: right;">90.2</td>
<td style="text-align: right;">55.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TNFAPC</td>
<td style="text-align: left;">LPS</td>
<td style="text-align: right;">25414</td>
<td style="text-align: right;">3.138646</td>
<td style="text-align: right;">25479</td>
<td style="text-align: right;">26722</td>
<td style="text-align: right;">95.3</td>
<td style="text-align: right;">99.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">TNFAPC</td>
<td style="text-align: left;">ECOLIGreen</td>
<td style="text-align: right;">25965</td>
<td style="text-align: right;">3.265506</td>
<td style="text-align: right;">26002</td>
<td style="text-align: right;">27518</td>
<td style="text-align: right;">94.5</td>
<td style="text-align: right;">99.9</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The fact that a very low percentage of cells are positive for TNF-α in the isotype control is a good indication that cut off we used for the <code>TNFa_APC_Lin</code> signal is a good one.</p>
<p>We can apply the same logic to the <code>E_coli_FITC_Lin</code> signal.</p>
<p>For either antibody when the treatment is media or LPS there is no <em>E.coli</em> so that level of <code>E_coli_FITC_Lin</code> signal is the control. When <code>E_coli_FITC_Lin</code> is &lt; 2 then cells are negative for <em>E.coli</em>; when <code>E_coli_FITC_Lin</code> is &gt; 2 then cells are positive for <em>E.coli</em>. The fact that this is also 2 is a coincidence - for your own data your values for both of these are likely to differ.</p>
<p>🎬 Define the threshold for the <code>E_coli_FITC_Lin</code> signal:</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fitc_cut</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>🎬 Plot the TNFa_APC_Lin and E_coli_FITC_Lin with the thresholds for both signals:</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">clean_trans_nondebris</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">E_coli_FITC_Lin</span>, </span>
<span>                                  y <span class="op">=</span> <span class="va">TNFa_APC_Lin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">128</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">apc_cut</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">fitc_cut</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">antibody</span> <span class="op">~</span> <span class="va">treatment</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="workshop_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>🎬 Add a label, <code>fitc</code>, to the data to indicate if the cell is positive or negative for FITC</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">clean_trans_nondebris</span> <span class="op">&lt;-</span> <span class="va">clean_trans_nondebris</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fitc <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">E_coli_FITC_Lin</span> <span class="op">&lt;</span> <span class="va">fitc_cut</span> <span class="op">~</span> <span class="st">"FITC -'ve"</span>,</span>
<span>                               <span class="va">E_coli_FITC_Lin</span> <span class="op">&gt;=</span> <span class="va">fitc_cut</span> <span class="op">~</span> <span class="st">"FITC +'ve"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="look-after-future-you" class="level2"><h2 class="anchored" data-anchor-id="look-after-future-you">Look after future you!</h2>
<p>🎬 This workshop is a template for the analysis of your own data. Go back through your script and check you understand what you have done. Can you identify where you will need to edit? Do you understand what you will need to assess in order to make edits needed for your own data? Examine all of the objects in the environment to check you understand what they are and why they are there.</p>
<p>You’re finished!</p>
</section></section><section id="well-done" class="level1"><h1>🥳 Well Done! 🎉</h1>
</section><section id="independent-study-following-the-workshop" class="level1"><h1>Independent study following the workshop</h1>
<p><a href="../../r4babs4/week-2/study_after_workshop.html">Consolidate</a></p>
</section><section id="the-code-file" class="level1"><h1>The Code file</h1>
<p>This contains all the code needed in the workshop even where it is not visible on the webpage.</p>
<p>The <code>workshop.qmd</code> file is the file I use to compile the practical. Qmd stands for Quarto markdown. It allows code and ordinary text to be interweaved to produce well-formatted reports including webpages. <a href="https://github.com/3mmaRand/R4BABS/blob/main/r4babs4/week-2/workshop.qmd">View the Qmd in Browser</a>. Coding and thinking answers are marked with <code>#---CODING ANSWER---</code> and <code>#---THINKING ANSWER---</code></p>
<p>Pages made with R <span class="citation" data-cites="R-core">(<a href="#ref-R-core" role="doc-biblioref">R Core Team 2023</a>)</span>, Quarto <span class="citation" data-cites="allaire2022">(<a href="#ref-allaire2022" role="doc-biblioref">Allaire et al. 2022</a>)</span>, <code>knitr</code> <span class="citation" data-cites="knitr">(<a href="#ref-knitr" role="doc-biblioref">Xie 2022</a>)</span>, <code>kableExtra</code> <span class="citation" data-cites="kableExtra">(<a href="#ref-kableExtra" role="doc-biblioref">Zhu 2021</a>)</span></p>
</section><section id="references" class="level1">



</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-allaire2022" class="csl-entry" role="listitem">
Allaire, J. J., Charles Teague, Carlos Scheidegger, Yihui Xie, and Christophe Dervieux. 2022. <em>Quarto</em>. <a href="https://doi.org/10.5281/zenodo.5960048">https://doi.org/10.5281/zenodo.5960048</a>.
</div>
<div id="ref-flowCore" class="csl-entry" role="listitem">
Ellis, B, Perry Haaland, Florian Hahne, Nolwenn Le Meur, Nishant Gopalakrishnan, Josef Spidlen, Mike Jiang, and Greg Finak. 2024. <span>“flowCore: flowCore: Basic Structures for Flow Cytometry Data.”</span>
</div>
<div id="ref-flowAI" class="csl-entry" role="listitem">
Monaco, Gianni, Hao Chen, Michael Poidinger, Jinmiao Chen, Joao Pedro de Magalhaes, and Anis Larbi. 2016. <span>“flowAI: Automatic and Interactive Anomaly Discerning Tools for Flow Cytometry Data”</span> 32. <a href="https://10.1093/bioinformatics/btw191">10.1093/bioinformatics/btw191</a>.
</div>
<div id="ref-parks2006" class="csl-entry" role="listitem">
Parks, David R., Mario Roederer, and Wayne A. Moore. 2006. <span>“A New <span>“</span>Logicle<span>”</span> Display Method Avoids Deceptive Effects of Logarithmic Scaling for Low Signals and Compensated Data.”</span> <em>Cytometry Part A</em> 69A (6): 541–51. <a href="https://doi.org/10.1002/cyto.a.20258">https://doi.org/10.1002/cyto.a.20258</a>.
</div>
<div id="ref-R-core" class="csl-entry" role="listitem">
R Core Team. 2023. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-tidyverse" class="csl-entry" role="listitem">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span></span>Tidyverse<span></span>”</span> 4: 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
<div id="ref-knitr" class="csl-entry" role="listitem">
Xie, Yihui. 2022. <span>“Knitr: A General-Purpose Package for Dynamic Report Generation in r.”</span> <a href="https://yihui.org/knitr/">https://yihui.org/knitr/</a>.
</div>
<div id="ref-kableExtra" class="csl-entry" role="listitem">
Zhu, Hao. 2021. <span>“kableExtra: Construct Complex Table with ’Kable’ and Pipe Syntax.”</span> <a href="https://CRAN.R-project.org/package=kableExtra">https://CRAN.R-project.org/package=kableExtra</a>.
</div>
</div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("^(?:http:|https:)\/\/3mmarand\.github\.io\/R4BABS");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Rand, E. (2023). Data Analysis in R for Becoming a Bioscientist (Version 0.1) <a href="https://github.com/3mmaRand/R4BABS" class="uri">https://github.com/3mmaRand/R4BABS</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
    <a class="nav-link" href="https://mastodon.social/users/3mma">
<p>Emma on mastodon</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/3mmaRand/R4BABS">
<p>Emma on GitHub</p>
</a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>